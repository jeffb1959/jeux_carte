<!-- v3.1 – Attente Confirmation – fond sombre et texte blanc -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Attente des joueurs – Soirée de carte</title>
  <style>
    :root{ --bg:#0b1220; --text:#ffffff; --accent:#4fd1c5; }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b1220 url('https://jads.ca/image/fond_jeep.webp') center/cover no-repeat fixed;color:var(--text);font-size:1.05rem;}
    .wrap{max-width:680px;margin:0 auto;padding:18px;display:grid;gap:16px}
    .card{background:rgba(0,0,0,0.35);border:1px solid #3a4a6a;border-radius:18px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.25);}
    h1{margin:4px 0 0;font-size:1.8rem;color:#ffffff}
    ul{list-style:none;padding:0;margin:0;display:grid;gap:8px}
    li{background:rgba(0,0,0,0.35);border:1px solid #3a4a6a;padding:10px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;color:#ffffff}
    .pill{padding:4px 10px;border-radius:999px;background:rgba(255,255,255,0.1);color:#fff;font-size:0.9rem}
    .ok{color:#22c55e}
    .wait{color:#facc15}
    .err{background:#2b0e12;border:1px solid #6b1f28;padding:10px;border-radius:12px;color:#ffd6db;display:none}
    canvas{display:block;margin:0 auto;background:#fff;border-radius:12px}
    .footer{color:#ffffff;text-align:center;font-size:.95rem;margin-top:8px}
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDLSnoOCdHXl-5sKaJ55hhFbv-quS156kg",
      authDomain: "soireecartev2.firebaseapp.com",
      projectId: "soireecartev2",
      storageBucket: "soireecartev2.firebasestorage.app",
      messagingSenderId: "784781686361",
      appId: "1:784781686361:web:033693cb22fb1a55af2348"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const qs = new URLSearchParams(location.search);
    const CODE = qs.get('code');

    const $ = id => document.getElementById(id);

    async function start(){
      $('code').textContent = CODE || '----';
      try{ await signInAnonymously(auth); }catch{}

      const ref = doc(db,'soirees',CODE);
      onSnapshot(ref,(snap)=>{
        if(!snap.exists()){
          $('error').style.display='block';
          $('error').textContent='Soirée introuvable.';
          return;
        }
        const data = snap.data();
        renderPlayers(data.players||[]);

        const confirmedCount = (data.players||[]).filter(p => p.confirmed).length;
        const expected = Number(data.playerCount||0);
        if(confirmedCount >= expected && data.status === 'setup'){
          window.location.href = `Selection_Jeux.html?code=${CODE}`;
        }
      });

      // QR code
      const qrCanvas = document.getElementById('qr');
      const size = 200;
      qrCanvas.width = size;
      qrCanvas.height = size;
      import('https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js').then(QR=>{
        QR.default.toCanvas(qrCanvas, `https://jads.ca/confirmation_joueurs.html?code=${CODE}`, {width:size,color:{dark:'#000',light:'#fff'}});
      });
    }

    function renderPlayers(players){
      const list = $('players');
      list.innerHTML = '';
      players.forEach(p => {
        const li = document.createElement('li');
        li.innerHTML = `<span>${p.name||'---'}</span><span class="pill ${p.confirmed?'ok':'wait'}">${p.confirmed?'Confirmé':'En attente'}</span>`;
        list.appendChild(li);
      });
    }

    window.addEventListener('DOMContentLoaded', start);
  </script>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>Attente des joueurs – Code <span class="pill" id="code">----</span></h1>
      <canvas id="qr"></canvas>
      <ul id="players"></ul>
      <div id="error" class="err"></div>
    </section>
    <div class="footer">v3.1 • Fond sombre 35% • Texte blanc pur • Style harmonisé</div>
  </main>
</body>
</html>
