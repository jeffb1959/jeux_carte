<!-- Dame de Pique — v6.4.0 (Finitions: messages, synchro, garde-fous) -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Dame de Pique — App</title>
  <style>
    :root{ --bg:#0b1220; --card:#111a2e; --text:#f5f7fb; --muted:#b9c2d0; --accent:#4fd1c5; --ok:#22c55e; --line:#243252; --danger:#ef4444; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:390px;margin:0 auto;padding:18px;display:grid;gap:18px}
    .titleRow{display:block;margin-bottom:8px}
    .titleRow h1{display:block;margin:0 0 8px 0;font-size:clamp(22px,5vw,28px)}
    .lbl{color:var(--muted);font-size:clamp(14px,4vw,16px)}
    .card{background:#111a2e;border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .grid{display:grid;gap:12px}
    .btn{appearance:none;border:none;cursor:pointer;width:100%;min-height:52px;padding:0 16px;border-radius:16px;font-size:clamp(17px,4vw,19px);font-weight:800;color:#0c111b;background:var(--accent)}
    .btn[disabled]{opacity:.6;filter:grayscale(.3);cursor:not-allowed}
    .line{display:flex;align-items:center;justify-content:space-between;background:#0f1a30;border:1px solid #243252;border-radius:12px;padding:10px 12px}
    .footer{text-align:center;color:var(--muted)}
    .back{color:#9bb3d1;text-decoration:none}
    .back:hover{text-decoration:underline}
    /* Modale */
    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);z-index:50}
    .modal.show{display:grid}
    .sheet{width:min(92vw,390px);background:#0d1527;border:1px solid #2b3857;border-radius:16px;padding:14px;box-shadow:0 12px 28px rgba(0,0,0,.45)}
    .sheet h3{margin:0 0 8px}
    .inp{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #334567;background:#0b1324;color:var(--text);font-size:1rem}
    .row{display:grid;gap:8px}
    .msg{color:var(--ok);font-size:0.9rem;text-align:center}
    .danger{color:var(--danger)}
    .meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .passTag{margin-left:auto;background:#14223f;border:1px solid #2b3e69;border-radius:10px;padding:6px 10px;font-size:.9rem}
    details.diag{border:1px dashed #2b3e69;border-radius:12px;padding:8px}
    details.diag>summary{cursor:pointer;color:#9bb3d1}
    .ok{color:var(--ok)}
    .dealerBadge{background:#14532d !important;border-color:#1a7f3a !important}
    .whoBtn{display:block;width:100%;padding:10px 12px;border-radius:12px;border:1px solid #2b3e69;background:#14223f;color:var(--text);font-weight:700;cursor:pointer}
    .whoBtn:hover{filter:brightness(1.05)}
    .hidden{display:none!important}
  </style>
</head>
<body>
  <main class="wrap">
    <header class="titleRow">
      <h1>Dame De Pique</h1>
      <div class="meta metaRow">
        <div class="lbl">Brasseur : <strong id="dealerName">—</strong></div>
        <div class="lbl">Tour n° <span id="round">1</span></div>
        <div id="passInfo" class="passTag">—</div>
      </div>
    </header>
    <section class="card grid" id="totalsCard">
      <div class="lbl">Scores totaux</div>
      <div id="totalsList" class="grid"></div>
      <div class="lbl" id="roundStatus">0/0 soumis</div>
      <div class="lbl danger" id="roundError"></div>
    </section>
    <div class="footer">
      <button id="btnEndGame" class="btn" type="button">Finir la partie</button>
    </div>
  </main>
  <script>
    const $=id=>document.getElementById(id);
    const onReady=fn=>{if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',fn,{once:true});}else{fn();}};
    const setText=(id,text)=>{const el=$(id);if(el)el.textContent=text;};
    onReady(()=>{
      const btn=document.getElementById('btnEndGame');
      if(!btn)return;
      let holdTs=0,bar;
      btn.addEventListener('mousedown',()=>{holdTs=Date.now();bar=document.createElement('div');bar.style.position='absolute';bar.style.left=0;bar.style.top=0;bar.style.bottom=0;bar.style.width='0%';bar.style.background='rgba(255,255,255,0.35)';bar.style.borderRadius='10px';bar.style.transition='width 2s linear';btn.style.position='relative';btn.appendChild(bar);setTimeout(()=>{bar.style.width='100%';},10);});
      btn.addEventListener('mouseup',()=>{const dt=Date.now()-holdTs;if(dt>=2000){location.href='selection_jeux.html';}if(bar)bar.remove();});
    });
  </script>
</body>
</html>
